---
tags:
  - 生活
author: WangXinYi
img: /images/homePage/生日提醒脚本.webp
summary: 生日提醒脚本
categories: 生活
typora-root-url: ..
date: 2021-10-21 18:17:33
---

## 服务器部署

### 一、创建数据库

1、云服务器Mysql修改密码

+ 在my.cnf中的[mysqld]下输入

```
skip-grant-tables
```

+ 终端输入以下命令

```
service mysqld restart
mysql -u root -p
use mysql
update user set password = password ('123456') where user = 'root';
flush privileges; 
service mysqld restart
```

+ 在my.cnf中的[mysqld]下删除刚刚输入的代码

2、创建表

```sql
CREATE TABLE `birth` (
  `id` int(100) NOT NULL AUTO_INCREMENT,
  `isBirthday` tinyint(4) DEFAULT NULL,
  `isPreGift` tinyint(4) DEFAULT NULL,
  `isLunardate` tinyint(4) DEFAULT NULL,
  `name` varchar(255) DEFAULT NULL,
  `birDate` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;

```

3、插入数据

```sql
INSERT INTO `birth` VALUES ('1', '1', '1', '1', 'XX', '0824');
```

4、远程连接云服务器数据库

+ 支持root用户允许远程连接mysql数据库

```sql
use mysql;
grant all privileges on *.* to 'root'@'%' identified by '123456' with grant option;
flush privileges;
```

+ 查看是否修改成功

```sql
 select user,host from user;
```

+ 远程连接云服务器数据库

  ​	这个密码是登录服务器SSH密码

<img src="/images/%E7%94%9F%E6%97%A5%E6%8F%90%E9%86%92%E8%84%9A%E6%9C%AC/image-20221027153238411.png" alt="远程连接服务器" style="zoom: 67%;" />

​			这个密码是登录Mysql的密码，**主机名一定要写localhost的**

<img src="/images/%E7%94%9F%E6%97%A5%E6%8F%90%E9%86%92%E8%84%9A%E6%9C%AC/image-20221027153314029.png" alt="远程连接Mysql" style="zoom:67%;" />

### 二、服务器定时执行脚本

1、安装crontab

```
yum install cronie
yum install crontabs
```

2、开启crontab服务

```python
service crond start 	#启动服务
#其他相关命令
service crond stop 		#关闭服务
service crond restart 	#重启服务
service crond reload 	#重新载入配置
```

3、在命令行输入: `crontab -e`  然后添加相应的任务，`:wq` 可以保存并退出编辑模式  或是  `ctrl+zz` 退出

存放位置在/var/spool/cron/root目录下,日志在var/log/cron

```
0 7 * * * python3 /wxyTest/birth.py #每天七点执行
* * * * * python3 /wxyTest/note.py  #每分钟执行一次
```

4、时间的有关语法

```
# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * command to be executed
```

### 其他学到知识

#### 1、导出/下载依赖

**第一种方法**

此命令将会列出当前开发环境所有依赖库到requirements.txt文件中，相对较为冗杂。在项目根目录位置，执行：

```
pip freeze > requirements.txt
```

**第二种方法**

使用pipreqs，这个工具的好处是可以通过对项目目录的扫描，自动发现使用了那些类库，自动生成依赖清单。缺点是可能会有些偏差，需要检查并自己调整下。

```python
pip install pipreqs
```

在项目根目录下运行：`pipreqs ./`  

如果是Windows系统，会报编码错误 

​		`(UnicodeDecodeError: 'gbk' codec can't decode byte 0xa8 in position 24: illegal multibyte sequence)`  

改成如下命令

```
pipreqs ./ --encoding=utf8
```

生成requirements.txt 文件后，可以根据这个文件下载所有的依赖

```
pip install -r requirements.txt
```

#### 2、查询自己的公网ip及赋予数据库远程连接权限

```python
curl ifconfig.me  
```

**需要注意的是一个是连接权限，一个所有权限是增删改查的权限**

赋予数据库远程连接权限

赋予连接数据库人员所有权限，在刚进入mysql输入，别在use mysql之后输入

```
grant all privileges on *.* to 'root'@'%' identified by '123456' with grant option;
```

#### 3、服务器改用465端口发送邮件

服务器会把25端口封掉，防止发送垃圾邮件，改用465端口发送邮件，可以看一下对比

```python
# server = smtplib.SMTP('smtp.qq.com')
server = smtplib.SMTP_SSL('smtp.qq.com')
```

#### 4、编码路径的三种写法

+ 在路径前面加r，即保持字符原始值的意思。

```
sys.path.append(r‘c:\Users\mshacxiang\VScode_project\web_ddt‘)
```

+ 替换为双反斜杠


```
sys.path.append(‘c:\\Users\\mshacxiang\\VScode_project\\web_ddt‘)
```

+ 替换为正斜杠


```
sys.path.append(‘c:/Users/mshacxiang/VScode_project/web_ddt‘)
```

#### 5、最稳定的青龙面板2.10.2的安装

安装在/root/ql位置下

+ 安装Doker


```
yum install docker-io –y
sudo systemctl start docker
sudo systemctl status docker
sudo systemctl enable docker
```

+ 拉取镜像

```
docker pull ytong825/qinglong:2.10.2
```

+ 创建容器/多容器更改容器名，注意： **端口是3885 不是5700 已经做了修改**


```
docker run -dit \
   -v $PWD/ql/config:/ql/config \
   -v $PWD/ql/log:/ql/log \
   -v $PWD/ql/db:/ql/db \
   -v $PWD/ql/repo:/ql/repo \
   -v $PWD/ql/raw:/ql/raw \
   -v $PWD/ql/scripts:/ql/scripts \
   -v $PWD/ql/jbot:/ql/jbot \
   -p 3885:5700 \
   --name qinglong \
   --hostname qinglong \
   --restart unless-stopped \
   ytong825/qinglong:2.10.2
```

+ 配置相关依赖
+ NodeJs

```
crypto-js
prettytable
dotenv
jsdom
date-fns
tough-cookie
tslib
ws@7.4.3
ts-md5
jsdom -g
jieba
fs
form-data
json5
global-agent
png-js
@types/node
require
typescript
js-base64
axios
```

+ Python3


```
requests
canvas
ping3
jieba
```

+ Linux


```
bizCode
bizMsg
lxml
```

+ 拉取KR库

```
定时规则：0 0 1 * *
ql repo https://github.com/KingRan/KR.git "jd_|jx_|jdCookie" "activity|backUp" "^jd[^_]|USER|utils|function|sign|sendNotify|ql|JDJR"


定时规则：0 0 1 * *
ql repo https://github.com/feverrun/my_scripts.git "jd_|jx_|jddj_|getCookie|getJDCookie" "backUp/activity|backUp/card|backUp/py|backUp/utils/|backUp/test|jd_fruits.js|jd_pet.js|jd_factory.js|jd_health.js|jd_sgmh.js|jd_dreamFactory.js|jd_plantBean.js" "^(jd|JD|JS)[^_]|USER|sendNotify|utils"
```

+ 青龙面板时间设置

第1个是秒，第2个是分，第3个是时，第4个是每月的哪日，第5个是哪月，第6个是每周的周几。

不限制的用 * 号替代，定期的时间用 ? 替代，间隔运行时间用“*/数字”替代

同一个时间位多个选项用","连接，同一个时间位一个区间用“-”连接。

每天执行，在天位或者周位用"?"都行，一般设置每天执行一次就行0 0 1 * * ?

具体示例如下：

```python
0 0 1 * * ? #每天 1 点触发
0 10 1 ? * * #每天 1:10 触发
*/5 * * * * ? #每隔 5 秒执行一次
0 */1 * * * ? #每隔 1 分钟执行一次
0 0 2 1 * ? * #每月 1 日的凌晨 2 点执行一次
0 0 1 * * ? #每天 23 点执行一次
0 0 1 * * ? #每天凌晨 1 点执行一次
0 0 1 1 ? * #每月 1 日凌晨 1 点执行一次
0 26,29,33 * * * ? #在 26 分、29 分、33 分执行一次
0 0 0,13,18,21 * * ? #每天的 0 点、13 点、18 点、21 点都执行一次
0 0 10,14,16 * * ? #每天上午 10 点，下午 2 点，4 点执行一次
0 0/30 9-17 * * ? #每天朝九晚五工作时间内每半小时执行一次
0 * 14 * * ? #每天下午 2 点到 2:59 期间的每 1 分钟触发
0 */5 14 * * ? #每天下午 2 点到 2:55 期间的每 5 分钟触发
0 */5 14,18 * * ? #每天下午 2 点到 2:55 期间和下午 6 点到 6:55 期间的每 5 分钟触发
0 0-5 14 * * ? #每天下午 2 点到 2:05 期间的每 1 分钟触发
0 15 10 15 ? * #每月 15 日上午 10:15 触发
```

+ 京东cookie

JD_COOKIE格式

```
pt_key=;pt_pin=;
pt_key=AAJjsV5lADAs-XCOf3cnb3IoMpRSvHeaUcXC-SZQELn5rKrZHJkD27-5-UaFLYDZ53GSYwlErbQ;pt_pin=wdYJUpexZFHdIj;
&pt_key=;pt_pin=;
&pt_key=;pt_pin=;
```



#### 6、删除Docker里的容器

+ 重启docker


```
systemctl restart docker
```

+ 重启容器

```
docker restart 4b1361a68543
```

+ 列出所有容器ID


```
docker ps -aq
```

+ 列出运行的容器ID


```
docker ps
```

+ 停止所有的容器，这样才能够删除其中的镜像


```
docker stop $(docker ps -a -q) 或者 docker stop $(docker ps -aq) 
```

+ 删除所有容器指令


```
docker rm $(docker ps -a -q) 或者 docker rm $(docker ps -aq) 
```

+ 查看当前镜像


```
docker images
```

+ 删除镜像，通过镜像的id来指定删除


```
docker rmi <image id>
```

+ 强制删除全部镜像


```
docker rmi -f $(docker images -q)
```

按ctrl+P+Q正常退出容器

#### 7、关闭端口进程

查看占用了4000端口号的PID

```
netstat -aon|findstr "4000"
```

关闭5200PID

```
taskkill /pid 5200 -t -f
```

#### 8、conda常用的命令

1. 查看安装了哪些包

```text
conda list
```

2. 查看当前存在哪些虚拟环境

```text
conda env list 
conda info -e
```

3. 检查更新当前conda

```text
conda update conda
```

4. Python创建虚拟环境

```text
conda create -n your_env_name python=x.x

conda create -n PSDWEB37 python=3.7
```

anaconda命令创建python版本为x.x，名字为your_env_name的虚拟环境。

**your_env_name文件可以在Anaconda安装目录envs文件下找到**。

5. 激活或者切换虚拟环境

打开命令行，输入python --version检查当前 python 版本。

```text
Linux:  source activate your_env_nam
Windows: activate your_env_name
```

6. 对虚拟环境中安装额外的包

```text
conda install -n your_env_name [package]
```

7. 关闭虚拟环境(即从当前环境退出返回使用PATH环境中的默认python版本)

```text
deactivate env_name
或者`activate root`切回root环境
Linux下：source deactivate 
```

8. 删除虚拟环境

```text
conda remove -n your_env_name --all
```

9. 删除环境钟的某个包

```text
conda remove --name $your_env_name  $package_name 
```

10. 设置国内镜像

    [http://Anaconda.org](https://link.zhihu.com/?target=http%3A//Anaconda.org)的服务器在国外，安装多个packages时，conda下载的速度经常很慢。清华TUNA镜像源有Anaconda仓库的镜像，将其加入conda的配置即可：

    

    添加Anaconda的TUNA镜像

    conda config --add channels [https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/](https://link.zhihu.com/?target=https%3A//mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/)

    

    TUNA的help中镜像地址加有引号，需要去掉设置搜索时显示通道地址

​       conda config --set show_channel_urls yes

11. 恢复默认镜像

    ```
    conda config --remove-key channels
    ```


12.进入python

```
python
import torch
print(torch.cuda.is_available())
ctrl+z退出
```

#### 9、Pytorch的安装

在这里面 [全部pytorch版本](https://download.pytorch.org/whl/torch_stable.html) 手动找到要下载的版本，

下载torch、torchvision、torchaudio 

+ 安装[torch、torchvision、torchaudio对应关系](https://blog.csdn.net/shiwanghualuo/article/details/122860521)版本要对应好
+ 调用GPU要的话下载cuda版本的，我的是12，所以12版本以下的都可以
+ 除了GPU，其他的一定一定一定要对应好，python的版本也要对应好，否则也会报错

<img src="/images/%E7%94%9F%E6%97%A5%E6%8F%90%E9%86%92%E8%84%9A%E6%9C%AC/image-20230414191326451.png" alt="" style="zoom: 80%;" />

下载后，随便放那个位置都可以，但要激活虚拟环境后，要切换到放的位置，执行以下命令即可

```
pip install 刚刚下载的三个名字
例如：
pip install torch-1.3.0-cp36-cp36m-win_amd64.whl
pip install torchvision-0.4.1-cp36-cp36m-win_amd64.whl
```



Command "python setup.py egg_info" failed with error code 1 in C:\Users\LENOVO\AppData\Local\Temp\pi





